# ДОБАВЛЕНО
1. В классе `DB_editor` библиотеки `db_tools` добавлен метод `get_black_list`, который для конкретного пользователя возвращает словарь:

   {"user_id": "id_пользователя", "blocked": [список заблокированных пользователей]}
с этой функцией поиск не стартовал если блеклист пустой
а зачем словарь? ведь хватит и просто списка с заблокированными ИД
2. Добавил функцию `user_database.get_black_list_user_id(user_vk_id)` на выходе список из ИД пользоватлей
3. В файл бота добавил флаг состояния `state_configed` и функцию `start_bot()`
4. Добавил фукции поиска города по названию введного пользователем `My_VKapi.search_city()`
5. Добавлена возможность сменить город
6. Добавлены методы и иcправлены методы для работы с БД
7. Все методы перекачевали в класс VkBot
8. Добавлены аннотации типов и docstring
9. Добавлены 2 клавиатуры для работы с избранным и black list
10. Добавлены методы удаления записей из ^^^^^^^^^^^^^^^^^^^^^
11. 

   


# ИСПРАВЛЕНО
1. В функции генерации нового пользователя `next_found_user_message` проверяем, что искомый пользователь не находится в черном списке:

   blocked_list = user_database.get_black_list(user_vk_id)
   if user_id not in blocked_list['blocked']:
   

2. Исправлены названия переменных: `%fined%` → `%found%`.
3. Исправлен функционал добавления в черный список.
4. Исправлен функционал добавления в избранное.
5. В функции генерации нового пользователя `next_found_user_message` проверяем, что искомый пользователь не находится в черном списке и список не пустой:

`blocked_list = user_database.get_black_list_user_id(user_vk_id)`

`if user_id not in blocked_list['blocked'] or len(blocked_list) == 0:`
В функции `My_VkApi.get_user_info()` сделал проверку наличия города
6. Декомпозиция, в глобальной видимости больше ничего нет
7. Все ответы пользователя разбиты на методы
8. 

# TO DO
- Получить токен пользователя 
`https://id.vk.com/about/business/go/docs/ru/vkid/latest/vk-id/connection/api-integration/api-description#Poluchenie-cherez-kod-podtverzhdeniya`


- [Исправлено] -> ### НО возможно стоит переделать избранное. Убрать порядковый номер насовсем ### Возможно стоит переделать избранное, зачем пользователю показывать уже добавленных, Добавлять именно ИД пользователя, а не порядковый номер  
- [Добавлено] Добавить возможность очищать черный список.
- [Добавлено] Рассмотреть возможность точечного удаления, а не очистки всего списка сразу.


- [Возможно_не_нужно] В функционале добавления в избранное используются вложения в виде ссылок на фотографии, однако мы их не используем (они отображаются пользователю, но затем остаются бездействующими в базе данных). Следует:
- [Возможно_не_нужно] Добавить возможность просмотра топ-3 фотографий из базы данных для конкретного пользователя при вызове списка избранных или рассмотреть альтернативный функционал.

- [Частично] Обработать все возможные исключения и ошибки:

  try:
      # Критический код
  except Exception as e:
      # Логирование ошибки и информирование пользователя
  


- [Частично] Бот зависает в различных ситуациях, когда итерация достигает конца списка. При попытке получить новые переменные возникает ошибка из-за отсутствия данных. Нужно обеспечить корректную работу во всех случаях, когда нажимаем любую кнопку.
- [Частично]В случае завершения списка, возможно, стоит генерировать его заново, или, как в задании пункт 6 дополнительных требований для сдачи: "В ВКонтакте максимальная выдача при поиске — 1 000 человек. Подумайте, как это ограничение можно обойти."


- [Проверил]Проверить наличие ошибок, когда пользователь вместо нажатий кнопок отправляет изображения, случайный текст, стикеры и т.д.
- [Выполнил]В текущий момент логика работы бота запускается только после нажатия кнопки "поиск пары". Генерируются начальные значения, и на их основе работает остальной функционал. Однако, если запустить бота и нажать любую кнопку, генерирующую нового пользователя (например, "пропустить" или "добавить в избранное"), функция `next_found_user_message(next(all_found_users_generator))` обратится к переменным `all_found_users = My_VkApi(user_token).search_users(opposite_sex, age_min, age_max, user_city)` и `all_found_users_generator = photo_generator(all_found_users)`, которые не существуют, так как они создаются при вызове "поиск пары", и бот зависнет.
- [Проверил]Для пользователей, не указавших город, возникает ошибка:

    "city": user_info_resp['response'][0]['city']['title'], KeyError: 'city'
    

- [Выполнил]Необходимо добавить возможность ввода города и обработать исключение, чтобы проверить, существует ли такой город.

# TO DO на будущее
- [Частично]Подготовить документацию, дополнить README.md.
- [Частично]Добавить докстринги.
- [Частично]Написать аннотации.
- Можно добавить кнопку для получения геолокации (уже пробовал, несложно). Ответом приходит какой-то геокод, который не подходит для VK API, возможно надо погуглить Yandex API, потому то карта используется их. Так можно брать город пользователя, исходя из его геолокации.
- Добавить выбор возраста/пола (?)
- Переработать названия переменных (очень много vk_id, vk_user_id, user_vk_id, event_user_id, user_id) (*мне поменять URL -> ID в избранных*)
- Написать документация по использованию программы
  
## Не обязательные требования:
1. Получать токен от пользователя с нужными правами.
2. [Выполнено] Добавлять человека в чёрный список, чтобы он больше не попадался при поиске, используя БД.
3. [Выполнено] Создать кнопки в чате для взаимодействия с ботом.
4. Добавить возможность ставить/убирать лайк выбранной фотографии.
5. К списку фотографий из аватарок добавлять список фотографий, где отмечен пользователь.
6. В ВКонтакте максимальная выдача при поиске — 1 000 человек. Подумайте, как это ограничение можно обойти.
 
results = []
count = 1000
offset = 0

while True:
    response = vk.users.search(count=count, offset=offset, city=city_id, age_from=age_min, age_to=age_max)
    results.extend(response['items'])
    
    if len(response['items']) < count:
        break  # Выход из цикла, если меньше 1000 результатов получено

    offset += count  # Увеличиваем сдвиг на 1000


7. Можно усложнить поиск, добавив поиск по интересам. Разбор похожих интересов — группы, книги, музыка — нужно будет провести с помощью анализа текста.
8. У каждого критерия поиска должны быть свои веса, то есть совпадение по возрасту должно быть важнее общих групп, интересы по музыке — важнее книг, наличие общих друзей — важнее возраста и т. д.